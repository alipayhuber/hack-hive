From acff8dca7f2edc084738e42424b99ca71f612792 Mon Sep 17 00:00:00 2001
From: Thejas Madhavan Nair <thejas@apache.org>
Date: Tue, 8 Oct 2013 18:43:32 +0000
Subject: [PATCH 076/375] HIVE-5478 : WebHCat e2e testsuite for hcat authorization tests needs some fixes (Deepesh Khandelwal via Thejas Nair)

git-svn-id: https://svn.apache.org/repos/asf/hive/trunk@1530384 13f79535-47bb-0310-9956-ffa450edef68
---
 hcatalog/src/test/e2e/templeton/build.xml          |    4 ++--
 .../src/test/e2e/templeton/tests/hcatperms.conf    |   10 +++++-----
 2 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/src/hcatalog/src/test/e2e/templeton/build.xml b/src/hcatalog/src/test/e2e/templeton/build.xml
index b858ca3..e952c81 100644
--- a/src/hcatalog/src/test/e2e/templeton/build.xml
+++ b/src/hcatalog/src/test/e2e/templeton/build.xml
@@ -125,8 +125,8 @@
         <property name="fork.factor.conf.file" value="1"/>
         <property name="e2e.debug" value="false"/>
         <property name="tests.to.run" value=""/>
-        <exec executable="${harness.dir}/test_harness.pl" dir="${test.location}" failonerror="true">
-            <env key="HARNESS_ROOT" value="${harness.dir}"/>
+        <exec executable="./test_harness.pl" dir="${test.location}" failonerror="true">
+            <env key="HARNESS_ROOT" value="."/>
             <env key="DRIVER_ROOT" value="${basedir}/drivers"/>
             <env key="TH_WORKING_DIR" value="${test.location}"/>
             <env key="TH_INPDIR_LOCAL" value="${inpdir.local}"/>
diff --git a/src/hcatalog/src/test/e2e/templeton/tests/hcatperms.conf b/src/hcatalog/src/test/e2e/templeton/tests/hcatperms.conf
index d4a525c..9b6d71f 100644
--- a/src/hcatalog/src/test/e2e/templeton/tests/hcatperms.conf
+++ b/src/hcatalog/src/test/e2e/templeton/tests/hcatperms.conf
@@ -170,7 +170,7 @@ $cfg =
 
     {
 
-     #check default db permissions 
+     #check db permissions 
      #the default group is currently the group of parent dir
 
      'num' => 5,
@@ -188,7 +188,7 @@ $cfg =
                   'url' => ':TEMPLETON_URL:/templeton/v1/ddl/database/hcatperms_e',
                   'user_name' => ':UNAME:',
                   'format_header' => 'Content-Type: application/json',
-                  'post_options' => ['{}']
+                  'post_options' => ['{ "permissions" : "rwx------" }']
 
                  }
                 ],
@@ -677,7 +677,7 @@ $cfg =
       'format_header' => 'Content-Type: application/json', 
       'user_name' => ':UNAME_OTHER:',
       'status_code' => 500,
-     'json_field_substr_match' => {'error' => 'unable to show tables'},
+     'json_field_substr_match' => {'error' => 'FAILED: AuthorizationException .*\.security\.AccessControlException: action READ not permitted on path .* for user :UNAME_OTHER:'},
 
 
     },
@@ -868,7 +868,7 @@ $cfg =
     },
 
     {
-     #check default permissions 
+     #check permissions 
      #the default group is currently the group of parent dir
      'num' => 2,
      'setup' => [
@@ -883,7 +883,7 @@ $cfg =
                   'method' => 'PUT',
                   'url' => ':TEMPLETON_URL:/templeton/v1/ddl/database/default/table/permstable_:TNUM:',
                   'format_header' => 'Content-Type: application/json', 
-                  'post_options' => ['{ "columns": [ { "name" : "i", "type" : "int" } ],"format" : {  "storedAs" : "rcfile"} }'],
+                  'post_options' => ['{ "columns": [ { "name" : "i", "type" : "int" } ],"format" : {  "storedAs" : "rcfile"}, "permissions" : "rwx------" }'],
                   'user_name' => ':UNAME:',
                   'status_code' => 200,
                  }
-- 
1.7.0.4

