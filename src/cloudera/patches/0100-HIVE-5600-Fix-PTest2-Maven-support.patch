From 8c5a3ccc47f9f6cedbf3efb148af08519e37b4c8 Mon Sep 17 00:00:00 2001
From: Brock Noland <brock@apache.org>
Date: Tue, 22 Oct 2013 14:44:55 +0000
Subject: [PATCH 100/375] HIVE-5600 - Fix PTest2 Maven support

git-svn-id: https://svn.apache.org/repos/asf/hive/trunk@1534648 13f79535-47bb-0310-9956-ffa450edef68
---
 testutils/ptest2/src/main/resources/batch-exec.vm  |    2 +-
 .../ptest2/src/main/resources/smart-apply-patch.sh |    2 +-
 testutils/ptest2/src/main/resources/source-prep.vm |    8 ++++----
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/src/testutils/ptest2/src/main/resources/batch-exec.vm b/src/testutils/ptest2/src/main/resources/batch-exec.vm
index ee550a1..5a1557e 100644
--- a/src/testutils/ptest2/src/main/resources/batch-exec.vm
+++ b/src/testutils/ptest2/src/main/resources/batch-exec.vm
@@ -62,7 +62,7 @@ then
   	testModule=./
   fi
   pushd $testModule
-  timeout 2h mvn -o test -Dmaven.repo.local=$localDir/$instanceName/maven \
+  timeout 2h mvn -B -o test -Dmaven.repo.local=$localDir/$instanceName/maven \
     $mavenArgs $mavenTestArgs $testArguments 1>$logDir/maven-test.txt 2>&1 </dev/null &
 #[[
   pid=$!
diff --git a/src/testutils/ptest2/src/main/resources/smart-apply-patch.sh b/src/testutils/ptest2/src/main/resources/smart-apply-patch.sh
index 977da8b..fce2735 100644
--- a/src/testutils/ptest2/src/main/resources/smart-apply-patch.sh
+++ b/src/testutils/ptest2/src/main/resources/smart-apply-patch.sh
@@ -84,7 +84,7 @@ elif $PATCH -p1 -E --dry-run < $PATCH_FILE 2>&1 > /dev/null; then
 elif $PATCH -p2 -E --dry-run < $PATCH_FILE 2>&1 > /dev/null; then
   PLEVEL=2
 else
-  echo "The patch does not appear to apply with p0 to p2";
+  echo "The patch does not appear to apply with p0, p1, or p2";
   cleanup 1;
 fi
 
diff --git a/src/testutils/ptest2/src/main/resources/source-prep.vm b/src/testutils/ptest2/src/main/resources/source-prep.vm
index d405bac..eca1fe4 100644
--- a/src/testutils/ptest2/src/main/resources/source-prep.vm
+++ b/src/testutils/ptest2/src/main/resources/source-prep.vm
@@ -85,11 +85,11 @@ cd $workingDir/
   if [[ "${buildTool}" == "maven" ]]
   then
     rm -rf $workingDir/maven/org/apache/hive
-    mvn clean install -DskipTests -Dmaven.repo.local=$workingDir/maven
-    mvn test -Dmaven.repo.local=$workingDir/maven -Dtest=nothing
+    mvn -B clean install -DskipTests -Dmaven.repo.local=$workingDir/maven
+    mvn -B test -Dmaven.repo.local=$workingDir/maven -Dtest=TestDummy
     cd itests
-    mvn clean install -DskipTests -Dmaven.repo.local=$workingDir/maven
-    mvn test -Dmaven.repo.local=$workingDir/maven -Dtest=nothing
+    mvn -B clean install -DskipTests -Dmaven.repo.local=$workingDir/maven
+    mvn -B test -Dmaven.repo.local=$workingDir/maven -Dtest=TestDummy
   elif [[ "${buildTool}" == "ant" ]]
   then
     ant $antArgs -Divy.default.ivy.user.dir=$workingDir/ivy \
-- 
1.7.0.4

